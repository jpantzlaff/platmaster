(function(t){function e(e){for(var i,o,s=e[0],c=e[1],l=e[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&p.push(r[o][0]),r[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);u&&u(e);while(p.length)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],i=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(i=!1)}i&&(a.splice(e--,1),t=o(o.s=n[0]))}return t}var i={},r={app:0},a=[];function o(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var u=c;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0477":function(t,e,n){},"0772":function(t,e,n){"use strict";var i=n("fc16"),r=n.n(i);r.a},"0c6f":function(t,e,n){},"0e7a":function(t,e,n){"use strict";var i=n("926b"),r=n.n(i);r.a},1629:function(t,e,n){"use strict";var i=n("6f91"),r=n.n(i);r.a},"195c":function(t,e,n){"use strict";var i=n("d0a2"),r=n.n(i);r.a},"1d83":function(t,e,n){"use strict";var i=n("2f77"),r=n.n(i);r.a},2458:function(t,e,n){"use strict";var i=n("7dd0"),r=n.n(i);r.a},"255b":function(t,e,n){"use strict";var i=n("0477"),r=n.n(i);r.a},"25eb":function(t,e,n){"use strict";var i=n("0c6f"),r=n.n(i);r.a},"2f77":function(t,e,n){},3347:function(t,e,n){},"34a1":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e),n.d(e,"db",(function(){return qt})),n.d(e,"state",(function(){return Jt})),n.d(e,"saveSettings",(function(){return Zt}));n("96cf");for(var i=n("1da1"),r=n("5530"),a=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("2b0e")),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("UiToolbar",{staticClass:"header",attrs:{brand:"PlatMaster",title:t.title,removeNavIcon:!0}}),n("div",{staticClass:"settings"},[n("UiIconButton",{staticClass:"setting-button",attrs:{icon:"settings",size:"normal",tooltip:"Adjust the settings of the application."},on:{click:t.openSettings}})],1),n("div",{staticClass:"rest"},[t.pages.length>0?n("Editor"):n("DocumentForm")],1),n("Settings",{ref:"settings"})],1)},s=[],c=(n("b0c0"),n("287d")),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"document-form"},[n("div",{staticClass:"file-drop"},[t.form.previewUrl?n("div",{staticClass:"preview"},[n("img",{staticClass:"preview-image",attrs:{src:t.form.previewUrl}})]):t._e(),n("UiFileupload",{attrs:{accept:"image/jpeg,image/png",multiple:!0,name:"image_files"},model:{value:t.form.files,callback:function(e){t.$set(t.form,"files",e)},expression:"form.files"}})],1),n("div",{staticClass:"form"},[n("UiTextbox",{attrs:{label:"Name",error:"A name must be provided.",invalid:!t.nameValid},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}}),n("UiSelect",{attrs:{label:"Unit of distance",options:t.distanceUnits},model:{value:t.form.distanceUnit,callback:function(e){t.$set(t.form,"distanceUnit",e)},expression:"form.distanceUnit"}}),n("UiSelect",{attrs:{label:"Basis of bearings",options:["Grid","True/geodetic north","Magnetic north"]},model:{value:t.form.bearingBasisType,callback:function(e){t.$set(t.form,"bearingBasisType",e)},expression:"form.bearingBasisType"}}),"Grid"===t.form.bearingBasisType?n("UiSelect",{attrs:{label:"Coordinate reference system of the grid",placeholder:"Search a projection name, location, or SRID code",disableFilter:!0,hasSearch:!0,loading:t.crsLoading,"no-results":t.crsNoResult,options:t.crsOptions,error:"A coordinate reference system must be specified.",invalid:!t.crsValid},on:{"query-change":t.crsQuery},model:{value:t.form.crs,callback:function(e){t.$set(t.form,"crs",e)},expression:"form.crs"}}):t._e(),"Magnetic north"===t.form.bearingBasisType?n("UiDatepicker",{attrs:{customFormatter:t.formatDate,label:"Date of survey (approximate)",error:"A date must be provided.",invalid:!t.dateValid,appendDropdownToBody:!0,yearRange:t.magDeclinationYears,orientation:"landscape"},model:{value:t.form.bearingBasisDate,callback:function(e){t.$set(t.form,"bearingBasisDate",e)},expression:"form.bearingBasisDate"}}):t._e(),n("UiButton",{staticClass:"submit",attrs:{disabled:!t.isValid,size:"large",icon:"library_add"},on:{click:t.submitForm}},[n("UiTooltip",{attrs:{openDelay:300}},[t._v(t._s(t.submitTooltip))]),t._v(" Start ")],1)],1)])},u=[],d=(n("99af"),n("a630"),n("caad"),n("d81d"),n("b64b"),n("d3b7"),n("ac1f"),n("2532"),n("3ca3"),n("1276"),n("ddb0"),n("2b3d"),n("1fff"),[{label:"Chain (India)",value:{abbr:"ind-ch",factor:20.11669506}},{label:"Chain (US)",value:{abbr:"us-ch",factor:20.11684023368047}},{label:"Foot",value:{abbr:"ft",factor:.3048}},{label:"Foot (India)",value:{abbr:"ind-ft",factor:.30479841}},{label:"Foot (US)",value:{abbr:"us-ft",factor:.304800609601219}},{label:"Inch",value:{abbr:"in",factor:.0254}},{label:"Meter",value:{abbr:"m",factor:1}},{label:"Yard",value:{abbr:"yd",factor:.9144}},{label:"Yard (India)",value:{abbr:"ind-yd",factor:.91439523}},{label:"Yard (US)",value:{abbr:"us-yd",factor:.914401828803658}}]),p=[],f=1590,m=Math.min((new Date).getFullYear(),2024);f<m;f++)p.push(f);var h=n("d4ec"),v=function t(e){var n=this;Object(h["a"])(this,t),this.file=e.file,this.id=e.id,this.points=[],this.objectUrl=URL.createObjectURL(this.file),this.size=new Promise((function(t){var e=new Image;e.src=n.objectUrl,e.decode().then((function(){t({height:e.naturalHeight,width:e.naturalWidth})}))}))},g=(n("4160"),n("4fad"),n("159b"),n("2909")),b=n("3835"),x=n("aa1a"),y=n.n(x),w=n("a79f");function C(t){return t*(Math.PI/180)}function P(t,e,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=Object(b["a"])(t,2),o=a[0],s=a[1],c=e;i&&(c+=Jt.localCrs.offset),c<0?c+=360:c>=360&&(c-=360);var l=r?_(c):c;return[o+n*Math.cos(l),s+n*Math.sin(l)]}function U(t,e){var n=Object(b["a"])(t,2),i=n[0],r=n[1],a=Object(b["a"])(e,2),o=a[0],s=a[1];return Math.atan2(s-r,o-i)}function k(t){var e=Object(b["a"])(t,3),n=e[0],i=e[1],r=e[2];if(!(n>=0&&n<360))throw Error("Degrees outside range 0-360");if(!(i>=0&&i<60))throw Error("Minutes outside range 0-60");if(!(r>=0&&r<60))throw Error("Seconds outside range 0-60");return n+i/60+r/3600}function _(t){var e=t;return e=90-e,e<0&&(e+=360),C(e)}function j(t,e){return O.apply(this,arguments)}function O(){return O=Object(i["a"])(regeneratorRuntime.mark((function t(e,n){var i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=new URL(e),Object.entries(n).forEach((function(t){var e;return(e=i.searchParams).append.apply(e,Object(g["a"])(t))})),t.prev=2,t.next=5,fetch(i.href).then((function(t){return t.text()}));case 5:r=t.sent,t.next=11;break;case 8:throw t.prev=8,t.t0=t["catch"](2),Error("No network connection.");case 11:return t.prev=11,t.abrupt("return",JSON.parse(r));case 15:throw t.prev=15,t.t1=t["catch"](11),Error("Request to ".concat(e," did not return JSON. Response:\n").concat(r));case 18:case"end":return t.stop()}}),t,null,[[2,8],[11,15]])}))),O.apply(this,arguments)}function R(t,e){return T.apply(this,arguments)}function T(){return T=Object(i["a"])(regeneratorRuntime.mark((function t(e,n){var i,r,a,o,s,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=Object(b["a"])(e,2),r=i[0],a=i[1],o=n.getFullYear(),!(o>=2019)){t.next=6;break}s="WMM",t.next=15;break;case 6:if(!(o>=2e3)){t.next=10;break}s="EMM",t.next=15;break;case 10:if(!(o>=1590)){t.next=14;break}s="IGRF",t.next=15;break;case 14:throw Error("Magnetic declination data are not available for years prior to 1590.");case 15:return t.next=17,j("https://www.ngdc.noaa.gov/geomag-web/calculators/calculateDeclination",{lat1:a,lat1Hemisphere:a<0?"S":"N",lon1:r,lon1Hemisphere:r<0?"W":"E",magneticComponent:"d",model:s,resultFormat:"json",startDay:n.getDate(),startMonth:n.getMonth()+1,startYear:o});case 17:return c=t.sent,t.prev=18,t.abrupt("return",c.result[0].declination);case 22:throw t.prev=22,t.t0=t["catch"](18),Error("A magnetic declination could not be calculated.");case 25:case"end":return t.stop()}}),t,null,[[18,22]])}))),T.apply(this,arguments)}function S(t,e,n){if("CRS-GEOGCRS"===t.kind)return 0;var i=Object(w["a"])(t.proj4),r=i.inverse([e,n]),a=i.inverse([e,n+10]);return y()(r,a)}function E(t){var e=t.getLatLng(),n=e.lat,i=e.lng;return[i,n]}function M(t){return D.apply(this,arguments)}function D(){return D=Object(i["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,j("https://epsg.io",{format:"json",q:e});case 2:return n=t.sent,t.abrupt("return",Array.isArray(null===n||void 0===n?void 0:n.results)?n.results.map((function(t){return{accuracy:t.accuracy,area:t.area,code:t.code,kind:t.kind,name:t.name,proj4:t.proj4,unit:t.unit}})):[]);case 4:case"end":return t.stop()}}),t)}))),D.apply(this,arguments)}function F(t){return t/Math.PI*180}n("a15b"),n("fb6a"),n("45fc"),n("a9e3"),n("f00c"),n("9129"),n("5319");var B={"YYYY-MM-DD":"en-CA","MM/DD/YYYY":"en-US","DD/MM/YYYY":"en-GB"};function N(t){return t.toLocaleDateString(B[Jt.settings.dateFormat])}function I(t){var e=Jt.settings.directionFormat;if("45.56"===e){var n=Number(t);if(Number.isFinite(n)){if(n>=0&&n<360)return n;throw Error("Number outside range 0-360")}throw Error("Invalid characters in string")}var i="N 45-33-36 E"===e?"-":".",r=t.replace(/ /g,""),a=r[0].toUpperCase(),o=r.slice(-1).toUpperCase(),s=r.slice(1,-1).split(i).map((function(t){return Number(t)}));if(!["N","S"].includes(a))throw Error("Invalid leading direction");if(!["E","W"].includes(o))throw Error("Invalid trailing direction");if(s.length<3||s.some((function(t){return Number.isNaN(t)})))throw Error("Invalid number");if(s[0]>90)throw Error("Invalid number");var c=k(s);return"N"===a?"E"===o?c:360-c:"E"===o?180-c:180+c}function Y(t){document.documentElement.style.setProperty("--color2",t)}function A(t){document.documentElement.style.setProperty("--color1",t)}function V(t){document.documentElement.style.setProperty("--editor-filter","invert(".concat(t?1:0,")"))}function L(t){document.documentElement.style.setProperty("--text-color",t),document.documentElement.style.setProperty("--light-text-color",t.slice(0,7)+"77")}var $={name:"DocumentForm",computed:{crsValid:function(){if("Grid"===this.form.bearingBasisType){var t=Object.keys(this.form.crs);return t.includes("label")&&t.includes("value")}return!0},dateValid:function(){return"Magnetic north"!==this.form.bearingBasisType||this.form.bearingBasisDate instanceof Date},filesValid:function(){return this.form.files.length>0},isValid:function(){return this.crsValid&&this.dateValid&&this.nameValid&&this.filesValid},nameValid:function(){return this.form.name.length>0},submitTooltip:function(){return this.filesValid?this.crsValid?this.dateValid?this.nameValid?"Proceed to georeference the selected file".concat(this.form.files.length>0?"s":"","."):"Provide a name.":"Provide an approximate date of survey.":"Provide the coordinate reference system used in the document.":"Select file(s) to georeference."}},data:function(){return{crsLoading:!1,crsNoResult:!1,crsOptions:[],distanceUnits:d,form:Jt.form,magDeclinationYears:p}},methods:{crsQuery:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.crsLoading=!0,M(t).then((function(t){e.crsNoResult=!1,e.crsOptions=t.map((function(t){return{label:"SRID:".concat(t.code," – ").concat(t.name),value:t}}))})).catch((function(){return e.crsNoResult=!0})).finally((function(){return e.crsLoading=!1}));case 2:case"end":return n.stop()}}),n)})))()},formatDate:N,submitForm:function(){Jt.pages=Array.from(this.form.files).map((function(t,e){return new v({file:t,id:e})})),Jt.activePage=Jt.pages[0]}},watch:{"form.bearingBasisType":function(t){"Magnetic north"!==t&&(this.form.bearingBasisDate=null)},"form.files":function(t){if(this.form.previewUrl&&URL.revokeObjectURL(this.form.previewUrl),t[0]){var e=t[0];this.form.previewUrl=URL.createObjectURL(e),"Untitled"===this.form.name&&(this.form.name=e.name.split(".")[0])}}},components:{UiButton:c["UiButton"],UiDatepicker:c["UiDatepicker"],UiFileupload:c["UiFileupload"],UiSelect:c["UiSelect"],UiTextbox:c["UiTextbox"],UiTooltip:c["UiTooltip"]}},G=$,z=(n("195c"),n("f2c1"),n("2877")),X=Object(z["a"])(G,l,u,!1,null,"657e79f5",null),W=X.exports,H=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"editor"},[n("Viewer",{staticClass:"view"}),n("div",{staticClass:"controls"},[n("div",{staticClass:"points"},[t._l(t.state.points,(function(t){return[n("FixedPoint",{key:t.id,attrs:{point:t}})]})),t.state.pendingPoint&&"absolute"===t.state.pendingPoint.type?n("AbsolutePointForm"):t._e(),t.state.pendingPoint&&"relative"===t.state.pendingPoint.type?n("RelativePointForm"):t._e(),t.newPointsAllowed?n("UiButton",{staticClass:"point-add",attrs:{icon:"add",tooltip:"Create a new point from coordinates."},on:{click:t.newAbsolutePoint}},[t._v(" Add Point ")]):t._e()],2),n("div",{staticClass:"control-buttons"},[n("UiButton",{staticClass:"export",attrs:{icon:"save_alt",size:"large",disabled:!t.exportAllowed},on:{click:t.runExport}},[n("UiTooltip",{attrs:{openDelay:1e3}},[t._v(t._s(t.exportTooltip))]),t._v(" Export ")],1)],1),n("UiModal",{ref:"exporting",staticClass:"exporting",attrs:{dismissible:!1,transition:"fade",size:"auto",removeHeader:!0}},[t.state.exportComplete?n("div",{staticClass:"conclusion"},[n("h2",{staticClass:"complete-text"},[t._v("Export complete")]),n("UiButton",{attrs:{icon:"replay"},on:{click:t.reload}},[t._v(" Start Over ")])],1):n("div",{staticClass:"progress"},[n("UiProgressCircular"),n("h2",{staticClass:"exporting-text"},[t._v("Exporting...")])],1)])],1)],1)},q=[],J=(n("a623"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"point-form"},[t._m(0),n("div",{staticClass:"xy"},[n("UiTextbox",{staticClass:"x",attrs:{placeholder:"X",type:"number",error:"Provide a value.",invalid:!t.xValid},model:{value:t.point.x,callback:function(e){t.$set(t.point,"x",e)},expression:"point.x"}}),n("p",{staticClass:"sep"},[t._v(",")]),n("UiTextbox",{staticClass:"y",attrs:{placeholder:"Y",type:"number",error:"Provide a value.",invalid:!t.yValid},model:{value:t.point.y,callback:function(e){t.$set(t.point,"y",e)},expression:"point.y"}})],1),n("UiSelect",{staticClass:"crs-select",attrs:{placeholder:"Search projection/SRID",disableFilter:!0,hasSearch:!0,loading:t.crsLoading,"no-results":t.crsNoResult,options:t.crsOptions,error:"Specify a coordinate system.",invalid:!t.crsValid},on:{"query-change":t.crsQuery},model:{value:t.point.crs,callback:function(e){t.$set(t.point,"crs",e)},expression:"point.crs"}}),n("div",{staticClass:"bottom"},[t.isValid?n("UiButton",{staticClass:"submit",attrs:{size:"normal",icon:"check"},on:{click:t.submitForm}},[t._v(" Confirm ")]):t._e()],1)],1)}),Z=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"top"},[n("p",{staticClass:"descriptor"},[t._v("New Point")])])}],Q={name:"AbsolutePointForm",computed:{crsValid:function(){return Boolean(this.point.crs.value)},isValid:function(){return this.crsValid&&this.xValid&&this.yValid},xValid:function(){return Number.isFinite(parseFloat(this.point.x))},yValid:function(){return Number.isFinite(parseFloat(this.point.y))}},data:function(){return{state:Jt,point:Jt.pendingPoint,crsLoading:!1,crsNoResult:!1,crsOptions:[]}},methods:{crsQuery:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.crsLoading=!0,M(t).then((function(t){e.crsNoResult=!1,e.crsOptions=t.map((function(t){return{label:"SRID:".concat(t.code," – ").concat(t.name),value:t}}))})).catch((function(){return e.crsNoResult=!0})).finally((function(){return e.crsLoading=!1}));case 2:case"end":return n.stop()}}),n)})))()},submitForm:function(){var t={id:Jt.points.length+1,nativeX:Number(this.point.x),nativeY:Number(this.point.y),nativeCrs:this.point.crs.value};if(Jt.localCrs.proj4){var e=Object(w["a"])(t.nativeCrs.proj4,Jt.localCrs.proj4,[t.nativeX,t.nativeY]),n=Object(b["a"])(e,2);t.localX=n[0],t.localY=n[1]}Jt.points.push(t),Jt.pendingPoint=null}},components:{UiButton:c["UiButton"],UiSelect:c["UiSelect"],UiTextbox:c["UiTextbox"]}},K=Q,tt=(n("80ba"),n("1629"),Object(z["a"])(K,J,Z,!1,null,"0ed2bfe6",null)),et=tt.exports,nt=(n("a4d3"),n("e01a"),n("d28b"),n("8a79"),n("2ca0"),n("055d")),it=n.n(nt),rt=n("21a6"),at=n("7e37"),ot=n.n(at),st=n("c4e3"),ct=n.n(st);function lt(){return ut.apply(this,arguments)}function ut(){return ut=Object(i["a"])(regeneratorRuntime.mark((function t(){var e,n,i,r,a,o,s,c,l,u,d,p,f,m,h,v,g,x,y,C,k,_,j,O,R,T,S,M,D,B,N,I,Y,A,V,L,$,G;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e=new ct.a,n=!0,i=!1,r=void 0,t.prev=4,a=Jt.pages[Symbol.iterator]();case 6:if(n=(o=a.next()).done){t.next=44;break}return s=o.value,c=s.points,l=E(c[0].marker),u=E(c[1].marker),d=[c[0].point.localX,c[0].point.localY],p=[c[1].point.localX,c[1].point.localY],f=it()(l,u),m=U(l,u),h=it()(d,p),v=U(d,p),g=m-v,x=h/f,t.next=21,s.size;case 21:for(y=t.sent,C={},k=0,_=["topLeft","topRight","bottomLeft","bottomRight"];k<_.length;k++)j=_[k],O=[j.endsWith("Left")?0:y.width,j.startsWith("bottom")?0:y.height],R=it()(l,O),T=U(l,O),S=R*x,M=T-g,M<0&&(M+=2*Math.PI),D=P(d,M,S,!1,!1),C[j]={local:D,page:O,wgs84:Object(w["a"])(Jt.localCrs.proj4).inverse(D)};return t.next=26,ot.a.read(s.objectUrl);case 26:return B=t.sent,B.rotate(F(-g)),t.t0=e,t.t1="".concat(Jt.form.name," - page ").concat(s.id+1,".png"),t.next=32,B.getBufferAsync("image/png");case 32:for(Y in t.t2=t.sent,t.t0.file.call(t.t0,t.t1,t.t2),N=1/0,I=-1/0,C)A=Object(b["a"])(C[Y].local,2),V=A[0],L=A[1],V<N&&(N=V),L>I&&(I=L);$=[String(x),"0.0","0.0",String(-x),String(N+x),String(I-x)].join("\n"),e.file("".concat(Jt.form.name," - page ").concat(s.id+1,".pgw"),$),G="      <PAMDataset>\n        <SRS>".concat(Jt.localCrs.proj4,'</SRS>\n        <Metadata domain="IMAGE_STRUCTURE">\n          <MDI key="INTERLEAVE">PIXEL</MDI>\n        </Metadata>\n      </PAMDataset>    ').replace(/  /g,"").replace(/\n/g,""),e.file("".concat(Jt.form.name," - page ").concat(s.id+1,".png.aux.xml"),G);case 41:n=!0,t.next=6;break;case 44:t.next=50;break;case 46:t.prev=46,t.t3=t["catch"](4),i=!0,r=t.t3;case 50:t.prev=50,t.prev=51,n||null==a.return||a.return();case 53:if(t.prev=53,!i){t.next=56;break}throw r;case 56:return t.finish(53);case 57:return t.finish(50);case 58:return t.t4=rt["saveAs"],t.next=61,e.generateAsync({type:"blob"});case 61:t.t5=t.sent,t.t6="".concat(Jt.form.name,".zip"),(0,t.t4)(t.t5,t.t6),Jt.exportComplete=!0;case 65:case"end":return t.stop()}}),t,null,[[4,46,50,58],[51,,53,57]])}))),ut.apply(this,arguments)}var dt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"point",on:{click:t.placePoint}},[n("div",{staticClass:"point-bar"},[n("div",{staticClass:"point-id-badge"},[n("p",{staticClass:"point-id"},[t._v(t._s(t.point.id))])]),n("UiIconButton",{staticClass:"relative-point",attrs:{icon:"timeline",tooltip:t.newPointTooltip,disabled:!t.newPointsAllowed},on:{click:t.newRelativePoint}})],1),n("div",{staticClass:"point-data",style:{cursor:t.xyPointer}},[n("UiTooltip",{attrs:{openDelay:750}},[t._v(t._s(t.tooltipContent))]),n("div",{staticClass:"point-xy"},[n("p",{staticClass:"point-x"},[t._v(t._s(t.point.nativeX))]),n("p",{staticClass:"point-sep"},[t._v(",")]),n("p",{staticClass:"point-y"},[t._v(t._s(t.point.nativeY))])]),n("p",{staticClass:"point-crs"},[t._v(t._s(t.point.nativeCrs.name))])],1)])},pt=[],ft={name:"FixedPoint",props:["point"],computed:{newPointTooltip:function(){return this.newPointsAllowed?"Create a new point relative to this one.":"No more than two points can exist for every page."},newPointsAllowed:function(){return!this.state.pendingPoint&&this.state.points.length<2*this.state.pages.length},pageHasThisPoint:function(){var t=this;return this.state.activePage.points.some((function(e){return e.point===t.point}))},placePointsAllowed:function(){return this.state.activePage.points.length<2},tooltipContent:function(){return this.pageHasThisPoint?"This point has already been added to the page.":this.placePointsAllowed?"Click to add this point to the page.":"No more points can be added to the page."},xyPointer:function(){return this.pageHasThisPoint||!this.placePointsAllowed?"not-allowed":"pointer"}},data:function(){return{state:Jt}},methods:{newRelativePoint:function(){this.state.pendingPoint={crs:{},origin:this.point,type:"relative",x:null,y:null}},placePoint:function(){this.placePointsAllowed&&!this.pageHasThisPoint&&(Jt.activePoint=this.point)}},components:{UiIconButton:c["UiIconButton"],UiTooltip:c["UiTooltip"]}},mt=ft,ht=(n("f930"),Object(z["a"])(mt,dt,pt,!1,null,"d68e7c40",null)),vt=ht.exports,gt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"point-form"},[n("div",{staticClass:"top"},[n("p",{staticClass:"descriptor"},[t._v("New Point from "),n("span",{staticClass:"id-badge"},[t._v(t._s(t.origin.id))])])]),n("div",{staticClass:"dd"},[n("UiTextbox",{staticClass:"direction",attrs:{placeholder:"Direction",error:'e.g. "'+t.state.settings.directionFormat+'"',invalid:!t.directionValid},model:{value:t.direction,callback:function(e){t.direction=e},expression:"direction"}}),n("p",{staticClass:"sep"},[t._v(",")]),n("UiTextbox",{staticClass:"distance",attrs:{placeholder:"Distance",type:"number",error:'e.g. "1234.56"',invalid:!t.distanceValid},model:{value:t.distance,callback:function(e){t.distance=e},expression:"distance"}})],1),n("div",{staticClass:"bottom"},[t.isValid?n("UiButton",{staticClass:"submit",attrs:{size:"normal",icon:"check"},on:{click:t.submitForm}},[t._v(" Confirm ")]):t._e()],1)])},bt=[],xt={name:"RelativePointForm",computed:{directionValid:function(){try{return I(this.direction),!0}catch(t){return!1}},distanceValid:function(){return Number.isFinite(parseFloat(this.distance))},isValid:function(){return this.directionValid&&this.distanceValid}},data:function(){return{state:Jt,origin:Jt.pendingPoint.origin,point:Jt.pendingPoint,direction:null,distance:null}},methods:{submitForm:function(){var t=P([this.origin.localX,this.origin.localY],I(this.direction),this.distance),e=Object(b["a"])(t,2),n=e[0],i=e[1],r=Object(w["a"])(Jt.localCrs.proj4,this.origin.nativeCrs.proj4,[n,i]),a=Object(b["a"])(r,2),o=a[0],s=a[1];Jt.points.push({id:Jt.points.length+1,localX:n,localY:i,nativeCrs:this.origin.nativeCrs,nativeX:o,nativeY:s}),Jt.pendingPoint=null}},components:{UiButton:c["UiButton"],UiTextbox:c["UiTextbox"]}},yt=xt,wt=(n("2458"),n("1d83"),Object(z["a"])(yt,gt,bt,!1,null,"159f1872",null)),Ct=wt.exports,Pt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"viewer"},[n("div",{ref:"leaflet",staticClass:"map",style:{cursor:t.mapCursor}}),t.state.pages.length>1?n("div",{staticClass:"switcher"},[t.state.activePage.id>0?n("UiIconButton",{staticClass:"advance",attrs:{icon:"keyboard_arrow_left",size:"mini",tooltip:"View previous page"},on:{click:t.backward}}):t._e(),n("p",{staticClass:"page-indicator"},[t._v("Page "+t._s(t.state.activePage.id+1))]),t.state.activePage.id<t.state.pages.length-1?n("UiIconButton",{staticClass:"advance",attrs:{icon:"keyboard_arrow_right",size:"mini",tooltip:"View next page"},on:{click:t.forward}}):t._e()],1):t._e()])},Ut=[],kt=n("e11e"),_t=n.n(kt),jt=(n("6cc5"),{name:"Viewer",mounted:function(){this.map=_t.a.map(this.$refs.leaflet,{attributionControl:!1,center:[0,0],crs:_t.a.CRS.Simple,maxZoom:10,minZoom:-100,zoom:0,zoomDelta:.5,zoomSnap:0}),this.map.on("click",this.addPoint),this.handlePage()},computed:{mapCursor:function(){return this.state.activePoint?"crosshair":"grab"}},data:function(){return{state:Jt,layer:null,map:null}},methods:{addPoint:function(t){if(Jt.activePoint){var e=_t.a.marker(t.latlng,{draggable:!0,icon:_t.a.divIcon({className:"point-symbol",html:String(Jt.activePoint.id)}),keyboard:!1}).addTo(this.map);Jt.activePage.points.push({marker:e,point:Jt.activePoint}),Jt.activePoint=null}},backward:function(){Jt.activePage=Jt.pages[Jt.activePage.id-1]},forward:function(){Jt.activePage=Jt.pages[Jt.activePage.id+1]},handlePage:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,i,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return Jt.activePoint=null,n=Jt.activePage,e.next=4,n.size;case 4:i=e.sent,r=i.height,a=i.width,t.layer&&t.layer.remove(),t.map.setMaxBounds(null),t.map.setMinZoom(-100),t.layer=_t.a.imageOverlay(n.objectUrl,[[0,0],[r,a]],{className:"editor-page"}),t.map.addLayer(t.layer),t.map.fitBounds(t.layer.getBounds(),{animate:!1,duration:0,padding:[50,50]}),t.map.setMaxBounds(t.map.getBounds()),t.map.setMinZoom(t.map.getZoom()+.01);case 15:case"end":return e.stop()}}),e)})))()}},watch:{"state.activePage":function(){this.handlePage()}},components:{UiIconButton:c["UiIconButton"]}}),Ot=jt,Rt=(n("0e7a"),n("25eb"),Object(z["a"])(Ot,Pt,Ut,!1,null,"b22a8112",null)),Tt=Rt.exports,St={name:"Editor",mounted:function(){0!==this.state.points.length||this.state.pendingPoint||(this.state.pendingPoint={crs:{},type:"absolute",x:null,y:null})},computed:{exportAllowed:function(){return this.state.pages.every((function(t){return t.points.length>=2}))},exportTooltip:function(){return this.exportAllowed?"Save the pages as georeferenced files.":"Two points must be added to every page before exporting."},newPointsAllowed:function(){return!this.state.pendingPoint&&this.state.points.length<2*this.state.pages.length}},data:function(){return{state:Jt}},methods:{newAbsolutePoint:function(){this.state.pendingPoint={crs:{},type:"absolute",x:null,y:null}},reload:function(){window.location.reload()},runExport:function(){this.$refs.exporting.open(),lt()}},watch:{"state.points":function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var n,i,r,a,o,s,c,l,u,d,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(Jt.localCrs.proj4||!Jt.points[0]){t.next=21;break}if(n=Jt.points[0],n.localX=0,n.localY=0,i=Object(w["a"])(n.nativeCrs.proj4).inverse([n.nativeX,n.nativeY]),r=Object(b["a"])(i,2),a=r[0],o=r[1],s=Jt.form.distanceUnit.value,Jt.localCrs.proj4=['PROJCS["'.concat(Jt.form.name,'"'),'GEOGCS["GCS_WGS_1984"','DATUM["WGS_1984"','SPHEROID["WGS_1984",6378137,298.257223563]]','PRIMEM["Greenwich",0]','UNIT["Degree",0.017453292519943295]]','PROJECTION["Azimuthal_Equidistant"]','PARAMETER["False_Easting",0]','PARAMETER["False_Northing",0]','PARAMETER["Central_Meridian",'.concat(a,"]"),'PARAMETER["Latitude_Of_Origin",'.concat(o,"]"),'UNIT["'.concat(s.abbr,'",').concat(s.factor,"]]")].join(","),c=Jt.form.bearingBasisType,"Magnetic north"!==c){t.next=20;break}return t.prev=9,t.next=12,R([a,o],Jt.form.bearingBasisDate);case 12:Jt.localCrs.offset=t.sent,t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](9),console.error(t.t0);case 18:t.next=21;break;case 20:if("Grid"===c)try{l=Object(w["a"])(Jt.form.crs.value.proj4,[a,o]),u=Object(b["a"])(l,2),d=u[0],p=u[1],Jt.localCrs.offset=S(Jt.form.crs.value,d,p)}catch(e){console.error(e)}case 21:case"end":return t.stop()}}),t,null,[[9,15]])})));function e(e){return t.apply(this,arguments)}return e}()},components:{AbsolutePointForm:et,FixedPoint:vt,RelativePointForm:Ct,UiButton:c["UiButton"],UiModal:c["UiModal"],UiProgressCircular:c["UiProgressCircular"],UiTooltip:c["UiTooltip"],Viewer:Tt}},Et=St,Mt=(n("255b"),n("6f3e"),Object(z["a"])(Et,H,q,!1,null,"17d9d978",null)),Dt=Mt.exports,Ft=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("UiModal",{ref:"modal",attrs:{size:"large",title:"Settings",transition:"fade",dismissOn:"close-button esc"},on:{close:t.save}},[n("div",{staticClass:"settings-section"},[n("h2",{staticClass:"settings-section-title"},[t._v("Colors")]),n("div",{staticClass:"settings-group"},[n("div",{staticClass:"setting"},[n("h3",[t._v("Primary")]),n("ColorPicker",{model:{value:t.color1,callback:function(e){t.color1=e},expression:"color1"}})],1),n("div",{staticClass:"setting"},[n("h3",[t._v("Secondary")]),n("ColorPicker",{model:{value:t.color2,callback:function(e){t.color2=e},expression:"color2"}})],1),n("div",{staticClass:"setting"},[n("h3",[t._v("Text")]),n("ColorPicker",{model:{value:t.colorText,callback:function(e){t.colorText=e},expression:"colorText"}})],1)]),n("UiCheckbox",{attrs:{label:"Invert color of pages in viewer"},model:{value:t.darkEditor,callback:function(e){t.darkEditor=e},expression:"darkEditor"}})],1),n("div",{staticClass:"settings-section"},[n("h2",{staticClass:"settings-section-title"},[t._v("Dates")]),n("div",{staticClass:"settings-group"},[n("div",{staticClass:"setting"},[n("UiSelect",{attrs:{label:"Date format",options:["YYYY-MM-DD","MM/DD/YYYY","DD/MM/YYYY"]},model:{value:t.dateFormat,callback:function(e){t.dateFormat=e},expression:"dateFormat"}})],1)])]),n("div",{staticClass:"settings-section input-settings"},[n("h2",{staticClass:"settings-section-title"},[t._v("Input")]),n("div",{staticClass:"settings-group"},[n("div",{staticClass:"setting"},[n("UiSelect",{attrs:{label:"Direction format",options:["45.56","N 45-33-36 E","N 45.33.36 E"],help:"When inputting, letters are case insensitive and spaces are ignored"},model:{value:t.directionFormat,callback:function(e){t.directionFormat=e},expression:"directionFormat"}})],1)])])])},Bt=[],Nt=n("c345"),It={name:"Settings",data:function(){return Jt.settings},methods:{open:function(){this.$refs.modal.open()},save:Zt},watch:{color1:function(t){return A(t.hex)},color2:function(t){return Y(t.hex)},colorText:function(t){return L(t.hex)},darkEditor:function(t){return V(t)}},components:{ColorPicker:Nt["Chrome"],UiCheckbox:c["UiCheckbox"],UiModal:c["UiModal"],UiSelect:c["UiSelect"]}},Yt=It,At=(n("a5ac"),n("f7ae"),Object(z["a"])(Yt,Ft,Bt,!1,null,"6ac7bb17",null)),Vt=At.exports,Lt={name:"App",computed:{title:function(){return Jt.pages.length>0?Jt.form.name:Jt.form.name?"New document: ".concat(Jt.form.name):"New document"}},data:function(){return Jt},methods:{openSettings:function(){this.$refs.settings.open()}},components:{DocumentForm:W,Editor:Dt,Settings:Vt,UiIconButton:c["UiIconButton"],UiToolbar:c["UiToolbar"]}},$t=Lt,Gt=(n("0772"),Object(z["a"])($t,o,s,!1,null,"14e3c7a5",null)),zt=Gt.exports,Xt=n("bee2"),Wt=n("b34e"),Ht=function(){function t(){Object(h["a"])(this,t),this.schema=Wt["schema"].create("platmaster",1),this.schema.createTable("settings").addColumn("id",Wt["Type"].INTEGER).addColumn("color1",Wt["Type"].STRING).addColumn("color2",Wt["Type"].STRING).addColumn("colorText",Wt["Type"].STRING).addColumn("darkEditor",Wt["Type"].BOOLEAN).addColumn("dateFormat",Wt["Type"].STRING).addColumn("directionFormat",Wt["Type"].STRING).addPrimaryKey(["id"],!0)}return Object(Xt["a"])(t,[{key:"delete",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,n,i){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=this.db.getSchema().table(e),t.abrupt("return",this.db.delete().from(r).where(r[n].eq(i)).exec());case 2:case"end":return t.stop()}}),t,this)})));function e(e,n,i){return t.apply(this,arguments)}return e}()},{key:"initialize",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.schema.connect();case 2:this.db=t.sent;case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"insert",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,n){var i,a,o,s,c,l=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=l.length>2&&void 0!==l[2]&&l[2],a=this.db.getSchema().table(e),o=Object(r["a"])({},n),o.id||(o.id=0),s=a.createRow(o),c=i?this.db.insertOrReplace():this.db.insert(),t.abrupt("return",c.into(a).values([s]).exec());case 7:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"select",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var n,i,r,a,o,s,c,l=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:[],i=this.db.getSchema().table(e),r=this.db.select().from(i),!(n.length>0)){t.next=8;break}return a=Object(b["a"])(n,3),o=a[0],s=a[1],c=a[2],t.abrupt("return",r.where(i[o][s](c)).exec());case 8:return t.abrupt("return",r.exec());case 9:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"update",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,n,i,r){var a,o,s,c,l,u,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(a=this.db.getSchema().table(e),o=this.db.update(a),s=0,c=Object.entries(r);s<c.length;s++)l=Object(b["a"])(c[s],2),u=l[0],d=l[1],o=o.set(a[u],d);return t.abrupt("return",o.where(a[n].eq(i)).exec());case 4:case"end":return t.stop()}}),t,this)})));function e(e,n,i,r){return t.apply(this,arguments)}return e}()}]),t}(),qt=new Ht,Jt={activePage:null,activePoint:null,exportComplete:!1,form:{bearingBasisDate:null,bearingBasisType:"True/geodetic north",crs:{},distanceUnit:{label:"Meter",value:{abbr:"m",factor:1}},files:[],name:"Untitled",previewUrl:null},localCrs:{offset:0,proj4:null},pages:[],pendingPoint:null,points:[],settings:{color1:"#283354",color2:"#212B48",colorText:"#DDE6FF",darkEditor:!1,dateFormat:"YYYY-MM-DD",directionFormat:"N 45.33.36 E"}};function Zt(){var t=Jt.settings,e=t.color1,n=t.color2,i=t.colorText;qt.insert("settings",Object(r["a"])({id:1},Jt.settings,{color1:"string"===typeof e?e:e.hex,color2:"string"===typeof n?n:n.hex,colorText:"string"===typeof i?i:i.hex}),!0)}Object(i["a"])(regeneratorRuntime.mark((function t(){var e,n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,qt.initialize();case 2:return t.next=4,qt.select("settings",["id","eq",1]);case 4:if(e=t.sent,e.length>0)for(i in n=e[0],Jt.settings)n[i]&&(Jt.settings[i]=n[i]);Y(Jt.settings.color2),A(Jt.settings.color1),V(Jt.settings.darkEditor),L(Jt.settings.colorText),new a["a"]({render:function(t){return t(zt)}}).$mount("#app");case 11:case"end":return t.stop()}}),t)})))()},"6f3e":function(t,e,n){"use strict";var i=n("cf33"),r=n.n(i);r.a},"6f91":function(t,e,n){},"774f":function(t,e,n){},"7dd0":function(t,e,n){},"80ba":function(t,e,n){"use strict";var i=n("d318"),r=n.n(i);r.a},"926b":function(t,e,n){},a5ac:function(t,e,n){"use strict";var i=n("f322"),r=n.n(i);r.a},cf33:function(t,e,n){},d0a2:function(t,e,n){},d318:function(t,e,n){},f2c1:function(t,e,n){"use strict";var i=n("3347"),r=n.n(i);r.a},f322:function(t,e,n){},f7ae:function(t,e,n){"use strict";var i=n("34a1"),r=n.n(i);r.a},f930:function(t,e,n){"use strict";var i=n("774f"),r=n.n(i);r.a},fc16:function(t,e,n){}});
//# sourceMappingURL=app.4a479ced.js.map
